## 問題

「chap04」データベースの「注文履歴」テーブルについて、以下の操作を行う、SQL 文を記述してください

### 問題 1

注文順かつその明細順に、すべての注文データを取得する。

```sql
SELECT * FROM 注文履歴 ORDER BY 注文番号, 注文枝番;
```

#### 正解: 10 / 不正解: 9 / 正解率: 53%

### 問題 2

2024 年 5 月 1 日から 2024 年 5 月 15 日の期間に注文のあった商品名の一覧を商品名順に取得する。

```sql
SELECT DISTINCT 商品名 FROM 注文履歴
WHERE 日付 BETWEEN '2024-05-01' AND '2024-05-15'
ORDER BY 商品名;
```

#### 正解: 10 / 不正解: 9 / 正解率: 53%

### 問題 3

ドリンクの商品について、注文番号、注文枝番、注文金額を取得する。ただし、注文金額の低いほうから 2 ～ 4 番目に該当する注文だけを対象とする。

```sql
SELECT 注文番号, 注文枝番, 注文金額
FROM 注文履歴
WHERE 分類 = '1'
ORDER BY 注文金額
LIMIT 3 OFFSET 1;
```

#### 正解: 9 / 不正解: 10 / 正解率: 47%

### 問題 4

その他の商品について、2 つ以上同時に購入された商品を取得し、日付、商品名、単価、数量、注文金額を購入日順に表示する。ただし、同日に売り上げたものは、数量の多い順に表示する。

```sql
SELECT 日付, 商品名, 単価, 数量, 注文金額 FROM 注文履歴 WHERE 分類 = '3' AND 数量 >= 2 ORDER BY 日付, 数量 DESC;
```

#### 正解: 12 / 不正解: 7 / 正解率: 63%

### 問題 5

商品の分類ごとに、分類、商品名、サイズ、単価を 1 つの表として取得する。また、サイズはドリンクの商品についてのみ表示し、分類と商品名の順に並べること。

```sql
SELECT 分類, 商品名, サイズ, 単価
FROM 注文履歴 WHERE 分類 = '1'
UNION
SELECT 分類, 商品名, null, 単価
FROM 注文履歴 WHERE 分類 = '2'
UNION
SELECT 分類, 商品名, null, 単価
FROM 注文履歴 WHERE 分類 = '3'
ORDER BY 1, 2
;
```

```sql
SELECT 分類, 商品名,
  CASE WHEN 分類 = '1'
    THEN サイズ
    ELSE NULL END AS サイズ, 単価
FROM 注文履歴
GROUP BY 分類, 商品名, サイズ, 単価
ORDER BY 分類, 商品名;
```

```sql
SELECT 分類, 商品名, nullif(サイズ, 'X') AS サイズ, 単価
FROM 注文履歴
GROUP BY 分類, 商品名, サイズ, 単価
ORDER BY 分類, 商品名;
```

#### 正解: 9 / 不正解: 10 / 正解率: 47%

### 問題 6

2024 年 5 月に最も多く注文された商品名とその合計注文数(別名は「合計数量」)を取得する SQL 文を記述してください。

```sql
SELECT 商品名, SUM(数量) AS 合計数量
FROM 注文履歴
WHERE 日付 BETWEEN '2024-05-01' AND '2024-05-31'
GROUP BY 商品名 ORDER BY 合計数量 DESC LIMIT 1;
```

#### 正解: 12 / 不正解: 7 / 正解率: 63%

### 問題 7

分類「2」（フード）のうち、注文金額が 1000 円を超える明細の注文番号、商品名、数量、注文金額を取得する SQL 文を記述してください。

```sql
SELECT 注文番号, 商品名, 数量, 注文金額
FROM 注文履歴
WHERE 分類 = '2' AND 注文金額 > 1000;
```

#### 正解: 14 / 不正解: 5 / 正解率: 74%

### 問題 8

1 回の注文（注文番号ごと）の合計金額が 1500 円を超える注文の、注文番号と合計金額(別名は「合計」)を取得する SQL 文を記述してください。

```sql
SELECT 注文番号, SUM(注文金額) AS 合計
FROM 注文履歴
GROUP BY 注文番号
HAVING 合計 > 1500;
```

#### 正解: 11 / 不正解: 8 / 正解率: 58%

### 問題 9

「サイズ」が「L」のドリンク商品（分類 1）について、日付ごとに売り上げた合計金額(別名は「売上合計」)を日付順に取得する SQL 文を記述してください。

```sql
SELECT 日付, SUM(注文金額) AS 売上合計
FROM 注文履歴
WHERE 分類 = '1' AND サイズ = 'L'
GROUP BY 日付
ORDER BY 日付;
```

#### 正解: 8 / 不正解: 11 / 正解率: 42%

### 問題 10

「注文履歴」テーブルの全レコードから、商品名が「コーヒー」で終わる商品の注文データを取得する SQL 文を記述してください。

```sql
SELECT * FROM 注文履歴
WHERE 商品名 LIKE '%コーヒー';
```

#### 正解: 17 / 不正解: 2 / 正解率: 89%
