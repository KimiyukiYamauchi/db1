## 問題

「chap07」データベースについて、以下のSQL文を記述してください。

### 問題1

車種コード「S02」「ハッチバック」の合計のレンタル金額を求めてください。列名は合計金額。

```sql
SELECT SUM(価格 * 
(SELECT SUM(レンタル日数)
  FROM レンタル
  WHERE 車種コード = 'S02')
) AS 合計金額
FROM  料金
WHERE 車種コード = 'S02';
```

```sql
SELECT SUM(レンタル日数 * 価格) AS 合計金額
FROM レンタル
JOIN 料金 ON レンタル.車種コード = 料金.車種コード
WHERE レンタル.車種コード = 'S02';
```

#### 正解: 9 / 不正解: 4 / 正解率: 69%

### 問題2

レンタル日数が2日以上の車種コードと車種名。列名は車種コード、車種名。重複は排除すること。

```sql
SELECT DISTINCT 車種コード, 車種名
FROM 料金
WHERE 車種コード IN (
  SELECT 車種コード FROM レンタル
  WHERE レンタル日数 >= 2
);
```

```sql
SELECT DISTINCT レンタル.車種コード, 料金.車種名
FROM レンタル
JOIN 料金 ON レンタル.車種コード = 料金.車種コード
WHERE レンタル日数 >= 2;
```

#### 正解: 10 / 不正解: 2 / 正解率: 83%

### 問題3

トータルのレンタル日数と車種数。列名は合計日数、車種数。
副問合せで、車種コードごとのレンタル日数の合計を求め、これを仮想表として利用する

```sql
SELECT SUM(日数合計) AS 合計日数, COUNT(*) AS 車種数
FROM (
  SELECT 車種コード, SUM(レンタル日数) AS 日数合計
  FROM レンタル
  GROUP BY 車種コード
) AS 集計;
```

#### 正解: 11 / 不正解: 2 / 正解率: 85%

### 問題4

勇者の現在の HP が、パーティー全員の HP の何％に当たるかを求めたい。適切な列を用いて次の列名で抽出する。ただし、割合は小数点第２位を四捨五入し、小数点第１位まで求めること。

```sql
SELECT 
  名称 AS なまえ,
  HP AS 現在のHP,
  ROUND(HP * 100 / (SELECT SUM(HP) FROM パーティー), 1) AS パーティーでの割合
FROM パーティー
WHERE 職業コード = '01';
```

#### 正解: 3 / 不正解: 10 / 正解率: 23%

### 問題5

魔法使いは回復魔法「みんなならお裾分け」を使って MP を回復した。この魔法は、本人を除くパーティー全員の MP 合計値の10％をもらうことができる。端数は四捨五入して魔法使いの MP を更新する。なお、魔法使い以外の MP は更新しなくてよいものとする。

```sql
UPDATE パーティー
SET MP = MP + ROUND((
  SELECT SUM(MP) * 0.1 FROM パーティー WHERE 職業コード != '20'
))
WHERE 職業コード = '20';
```

#### 正解: 7 / 不正解: 6 / 正解率: 54%

### 問題6

経験イベントテーブルから、これまでにクリアしたイベントのうち、タイプが「強制」または「特殊」であるものについて、副問い合わせを用いて次の形式で抽出する。
- イベント番号
- クリア結果

```sql
SELECT イベント番号, クリア結果
FROM 経験イベント
WHERE クリア区分 = '1'
  AND イベント番号 IN (
    SELECT イベント番号
    FROM イベント
    WHERE タイプ IN ('1', '3')
  );
```

#### 正解: 4 / 不正解: 9 / 正解率: 31%

### 問題7

パーティーテーブルから、パーティー内で最も高い MP を持つキャラクター名とその MP を副問い合わせを用いて抽出する。列名は名称、MP。

```sql
SELECT 名称, MP
FROM パーティー
WHERE MP = (SELECT MAX(MP) FROM パーティー);
```

#### 正解: 8 / 不正解: 5 / 正解率: 62%