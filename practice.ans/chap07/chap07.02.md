## 問題

「chap07」データベース牛を個体識別番号で管理している個体識別テーブルがあります。このテーブルについて、次の問題1〜3で指示されたSQL文を作成してください。

### 問題1

飼育県別に飼育頭数を集計し、その結果を頭数集計テーブルに登録する。

```sql
INSERT INTO 頭数集計 (飼育県, 頭数)
SELECT 飼育県, COUNT(*)
FROM 個体識別
GROUP BY 飼育県;
```
#### 正解: 11 / 不正解: 4 / 正解率: 73%

### 問題2

飼育頭数の多い上位3つの都道府県における牛の情報（都道府県名、個体識別番号、雌雄）を個体識別テーブルから抽出する。雌雄は日本語表記。

```sql
SELECT 
  個体識別.飼育県,
  個体識別.個体識別番号,
  CASE 雌雄コード
    WHEN '1' THEN '雄'
    WHEN '2' THEN '雌'
  END AS 雌雄
FROM 個体識別
JOIN (
  SELECT 飼育県
  FROM 頭数集計
  ORDER BY 頭数 DESC
  LIMIT 3
) AS 上位県 USING (飼育県);
```
```sql
select
個体識別.飼育県 as 都道府県名,
個体識別.個体識別番号,
case 個体識別.雌雄コード
when '1' then '雄'
when '2' then '雌'
else '不明'
end as 雌雄
from
個体識別
where
個体識別.飼育県 in (
select 飼育県
from (
select 飼育県
from 頭数集計
order by 頭数 desc
limit 3
) as 上位3県
);
```

- これはエラーとなる
```sql
SELECT 飼育県, 個体識別番号,
  CASE 雌雄コード WHEN '1' THEN '雄' WHEN '2' THEN '雌' END AS 雌雄
FROM 個体識別
WHERE 飼育県 IN (
  SELECT 飼育県
  FROM 頭数集計
  ORDER BY 頭数 DESC
  LIMIT 3
);
```
#### 正解: 8 / 不正解: 7 / 正解率: 53%

### 問題3

母牛が乳用種（品種コード = '01'）である牛の情報を個体識別テーブルから抽出。品種は日本語で表示。

```sql
SELECT 個体識別番号,
  CASE 品種コード WHEN '01' THEN '乳用種' WHEN '02' THEN '肉用種' WHEN '03' THEN '交雑種' END AS 品種,
  出生日, 母牛番号
FROM 個体識別
WHERE 母牛番号 IN (
  SELECT 個体識別番号 FROM 個体識別 WHERE 品種コード = '01'
);
```
#### 正解: 6 / 不正解: 9 / 正解率: 40%

---

「rpg」データベースの「パーティー」、「イベント」、「経験イベント」テーブルについて、以下の操作を行う、SQL 文を記述してください

### 問題4

これまでに着手していないイベントについて、イベント番号とその名称をイベント番号順に副問い合わせを用いて抽出する。列名はイベント番号、イベント名称。

```sql
SELECT イベント番号, イベント名称
FROM イベント
WHERE イベント番号 NOT IN (
  SELECT イベント番号 FROM 経験イベント
)
ORDER BY イベント番号;
```
#### 正解: 11 / 不正解: 4 / 正解率: 73%

### 問題5

これまでに着手していないイベントの数を副問い合わせを用いて抽出する。列名は未着手イベント数。

```sql
SELECT COUNT(*) AS 未着手イベント数
FROM イベント
WHERE イベント番号 NOT IN (
  SELECT イベント番号 FROM 経験イベント
);
```
#### 正解: 12 / 不正解: 3 / 正解率: 80%

### 問題6

5番目にクリアしたイベントのイベント番号より小さい番号を持つすべてのイベントについて、イベント番号とイベント名称を抽出する。

```sql
SELECT イベント番号, イベント名称
FROM イベント
WHERE イベント番号 < (
  SELECT イベント番号
  FROM 経験イベント
  WHERE クリア区分 = '1'
  ORDER BY イベント番号
  LIMIT 1 OFFSET 4
);
```
#### 正解: 8 / 不正解: 7 / 正解率: 53%

### 問題7

これまでにパーティーがクリアしたイベントを前提としているイベントを次の形式で抽出する。
- イベント番号
- イベント名称
- 前提イベント番号

```sql
SELECT イベント番号, イベント名称, 前提イベント番号
FROM イベント
WHERE 前提イベント番号 IN (
  SELECT イベント番号
  FROM 経験イベント
  WHERE クリア区分 = '1'
);
```
#### 正解: 8 / 不正解: 7 / 正解率: 53%

### 問題8

パーティーは、イベント番号「9」のイベントを結果「B」でクリアし、その次に発生するイベントに参加した。これを経験イベントテーブルに記録する。なお、更新と追加の両方を２つのSQL文で記述すること。(経験イベントテーブルに対する更新と追加)

```sql
UPDATE 経験イベント
SET クリア区分 = '1',
    クリア結果 = 'B',
    ルート番号 = (SELECT MAX(ルート番号) + 1 FROM 経験イベント)
WHERE イベント番号 = 9;

INSERT INTO 経験イベント
VALUES ((SELECT イベント番号 FROM イベント WHERE 前提イベント番号 = 9), '0', NULL, NULL);
```
#### 正解: 6 / 不正解: 9 / 正解率: 40%
