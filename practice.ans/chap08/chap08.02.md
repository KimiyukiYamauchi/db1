## 問題

「rpg」データベースについて、以下のSQL文を記述してください。

### 問題1

すでにクリアしたイベントについて、次の形式で抽出する。・ルート番号・イベント番号・イベント名称・クリア結果（クリアした順番に表示）

```sql
SELECT e.ルート番号, e.イベント番号, v.イベント名称, e.クリア結果
FROM 経験イベント e
JOIN イベント v ON e.イベント番号 = v.イベント番号
WHERE e.クリア区分 = '1'
ORDER BY e.ルート番号;
```
#### 正解: 10 / 不正解: 1 / 正解率: 91%

### 問題2

イベントテーブルから、タイプ「強制」のイベントについて、イベント番号とイベント名称、パーティーのクリア区分を抽出する。ただし、これまでに未着手のイベントは考慮しなくてよい。

```sql
SELECT e.イベント番号, v.イベント名称, e.クリア区分
FROM 経験イベント e
JOIN イベント v ON e.イベント番号 = v.イベント番号
WHERE v.タイプ = '01';
```
#### 正解: 4 / 不正解: 7 / 正解率: 36%

### 問題3

現在のパーティーに参加しているキャラクターについて、次の形式でID順に抽出する。・ID・なまえ・職業・状態（職業と状態はコードテーブルより日本語表記）

```sql
SELECT p.ID, p.名称 AS なまえ, 
       c1.コード名称 AS 職業, 
       c2.コード名称 AS 状態
FROM パーティー p
JOIN コード c1 ON c1.コード種別 = 1 AND p.職業コード = c1.コード値
JOIN コード c2 ON c2.コード種別 = 2 AND p.状態コード = c2.コード値
ORDER BY p.ID;
```
#### 正解: 9 / 不正解: 2 / 正解率: 82%

### 問題4

現在のパーティーに参加しているキャラクターと、未参加の職業を次の形式で抽出する。・ID(未参加はNULL)・なまえ（未参加は「仲間になっていない！」と表示）・職業

```sql
SELECT p.ID, p.名称 AS なまえ, c.コード名称 AS 職業
FROM パーティー p
JOIN コード c ON c.コード種別 = 1 AND p.職業コード = c.コード値
UNION
SELECT NULL AS ID, '（仲間になっていない！）' AS なまえ, c.コード名称 AS 職業
FROM コード c
WHERE c.コード種別 = 1
  AND c.コード値 NOT IN (SELECT 職業コード FROM パーティー);
```
#### 正解: 8 / 不正解: 3 / 正解率: 73%

### 問題5

参加済みイベントのクリア結果を次の形式で抽出する。・イベント番号・クリア区分・クリア結果（「コード値:コード名称」形式、未記録分も含む）

```sql
SELECT e.イベント番号, 
       クリア区分,
       CONCAT(c.コード値, ':', c.コード名称) AS クリア結果
FROM 経験イベント e
LEFT JOIN コード c
  ON e.クリア結果 = c.コード値
UNION
SELECT e.イベント番号, 
       クリア区分,
       CONCAT(c.コード値, ':', c.コード名称) AS クリア結果
FROM 経験イベント e
RIGHT JOIN コード c
  ON e.クリア結果 = c.コード値
WHERE c.コード種別 = 4;
```
#### 正解: 2 / 不正解: 9 / 正解率: 18%

### 問題6

イベントテーブルから、前提イベントが設定されているイベントについて、次の形式で抽出する。・イベント番号・イベント名称・前提イベント番号・前提イベント名称

```sql
SELECT e.イベント番号, e.イベント名称,
       e.前提イベント番号, v.イベント名称 AS 前提イベント名称
FROM イベント e
JOIN イベント v ON e.前提イベント番号 = v.イベント番号;
```
#### 正解: 9 / 不正解: 2 / 正解率: 82%

### 問題7

イベントテーブルから、前提イベントまたは後続イベントが設定されているイベントについて、次の形式で抽出する。
・イベント番号・イベント名称・前提イベント番号・前提イベント名称・後続イベント番号・後続イベント名称

```sql
SELECT e.イベント番号, e.イベント名称,
       e.前提イベント番号, v1.イベント名称 AS 前提イベント名称,
       e.後続イベント番号, v2.イベント名称 AS 後続イベント名称
FROM イベント e
LEFT JOIN イベント v1 ON e.前提イベント番号 = v1.イベント番号
LEFT JOIN イベント v2 ON e.後続イベント番号 = v2.イベント番号
WHERE e.前提イベント番号 IS NOT NULL OR e.後続イベント番号 IS NOT NULL;
```
#### 正解: 7 / 不正解: 4 / 正解率: 64%

### 問題8

ほかのイベントの前提となっているイベントについて、次の形式でイベント番号順に抽出する。
・イベント番号・イベント名称・前提イベント数

```sql
SELECT E.イベント番号, E.イベント名称, Z.前提イベント数
FROM イベント E
JOIN (
  SELECT 前提イベント番号, COUNT(前提イベント番号) AS 前提イベント数
  FROM イベント
  WHERE 前提イベント番号 IS NOT NULL
  GROUP BY 前提イベント番号
) Z ON E.イベント番号 = Z.前提イベント番号
ORDER BY E.イベント番号;
```

```sql
SELECT e.イベント番号, e.イベント名称,
       (SELECT COUNT(*) FROM イベント WHERE 前提イベント番号 = e.イベント番号) AS 前提イベント数
FROM イベント e
ORDER BY e.イベント番号;
```
#### 正解: 10 / 不正解: 1 / 正解率: 91%
